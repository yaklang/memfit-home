---
sidebar_position: 2
title: 数据流
---

# 数据流与交互控制

Memfit AI 的数据流是一个支持双向交互、动态分支的复杂网络，根据用户入口的不同智能适配控制流。

## 双模态用户入口

### Coordinator 入口 (Plan-Execute 模式)

- **适用场景：** 任务模糊、复杂（如"对目标进行全面安全审计"）
- **控制流：** 用户 → Coordinator → 规划循环（任务树）→ 审查 → 运行时 → ReAct Loops
- **交互点：**
  - **规划审查** - 用户修改或批准规划
  - **全局中断** - 用户可暂停或取消执行

### ReAct 入口 (即时执行模式)

- **适用场景：** 指令明确、原子化（如"扫描指定 IP"）
- **控制流：** 用户 → ReAct Loop → 思考 → 行动 → 观察
- **交互点：**
  - **请求澄清** - 信息缺失时
  - **行动确认** - 敏感操作时

## 核心数据流转闭环

无论从哪个入口启动，数据都会在以下组件间形成闭环：

### 1. 上下文构建

输入（Query + History）经过以下增强：
- **Memory Triage** - 长期记忆检索
- **RAG System** - 领域知识增强

### 2. 决策制定

LLM 结合增强后的上下文输出结构化指令：
- 复杂任务的 Plan JSON
- 原子操作的 ReAct Thought/Action

### 3. 执行与交互

系统执行以下操作之一：
- 调用工具（本地或 MCP）
- 触发人机协作

### 4. 反馈与学习

- 工具输出提供短期反馈
- Memory Triage 异步分析执行链路
- 关键信息沉淀至向量数据库

## 数据流图

```
┌─────────────────────────────────────────────────────────────┐
│                      用户输入                                │
└─────────────────────────────┬───────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                     上下文构建                               │
│  ┌───────────────┐         ┌───────────────┐                │
│  │ Memory Triage │         │  RAG System   │                │
│  └───────┬───────┘         └───────┬───────┘                │
│          └─────────────┬───────────┘                        │
└────────────────────────┼────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│                   决策制定 (LLM)                             │
│            规划生成 / ReAct 推理                             │
└─────────────────────────┬───────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                    执行与交互                                │
│  ┌───────────────┐    ┌───────────────┐    ┌─────────────┐  │
│  │   本地工具    │    │   MCP 工具    │    │   人工介入  │  │
│  └───────────────┘    └───────────────┘    └─────────────┘  │
└─────────────────────────┬───────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                    反馈与学习                                │
│       结果 → 记忆更新 → 向量数据库持久化                     │
└─────────────────────────────────────────────────────────────┘
```

