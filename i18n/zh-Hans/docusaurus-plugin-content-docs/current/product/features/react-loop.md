---
sidebar_position: 2
title: ReAct 循环
---

# ReAct 循环

ReAct Loop 是 Memfit AI 中的最小执行单元，在独立上下文中驱动 "Reasoning-Acting" 循环。

## 核心组件

### LoopEngine

LoopEngine 管理每个 ReAct 迭代的状态流转：
- 处理状态转换
- 管理迭代限制
- 跟踪执行历史
- 与可靠性机制协调

### Action Registry

Action Registry 维护可用的动作：
- 注册自定义动作
- 将动作名称映射到实现
- 验证动作参数
- 处理动作生命周期

### Prompt Manager

Prompt Manager 为 LLM 生成上下文：
- 构建系统提示词
- 注入工具描述
- 添加记忆上下文
- 格式化对话历史

## 执行循环

每个 ReAct Loop 遵循以下循环：

```
┌──────────────────────────────────────────┐
│                观察                       │
│       收集环境状态和反馈                   │
└─────────────────────┬────────────────────┘
                      ↓
┌──────────────────────────────────────────┐
│                推理                       │
│         LLM 推理和自旋检测                 │
└─────────────────────┬────────────────────┘
                      ↓
┌──────────────────────────────────────────┐
│                行动                       │
│          执行工具或请求信息                │
└─────────────────────┬────────────────────┘
                      ↓
                 (下一轮迭代)
```

## 专注模式

专注模式允许定义专门的执行上下文：

### 使用场景

- **代码审计模式** - 专门用于代码分析
- **漏洞扫描模式** - 优化用于安全扫描
- **报告生成模式** - 专注于文档生成

### 实现方式

一个 Loop 可以被封装为 Action，允许：
- 将当前上下文压栈
- 启动专门的子 Loop
- 完成专注任务
- 弹出并返回父上下文

## 动态能力

### 暂停与升级

ReAct Loop 支持：
- **动态暂停** - 暂停等待用户输入
- **帮助请求** - 向用户请求澄清
- **触发规划** - 对复杂子任务升级到 Plan 引擎

### 模式切换

在以下模式间无缝切换：
- 即时执行模式
- Plan-Execute 模式
- 专注模式

## 可靠性特性

### 内置保护

- **自我反思** - 分析循环内的失败
- **自旋检测** - 防止无限循环
- **步数限制** - 强制最大迭代次数

### 错误恢复

当发生错误时：
1. 捕获错误上下文
2. 触发自我反思
3. 生成修正计划
4. 以增强感知重试

## 配置选项

| 选项 | 描述 | 默认值 |
|------|------|--------|
| `maxSteps` | 最大迭代次数 | 20 |
| `spinThreshold` | 自旋检测前的步数 | 3 |
| `reflectionTrigger` | 何时触发反思 | 错误时 |
| `focusMode` | 专门模式名称 | 无 |

